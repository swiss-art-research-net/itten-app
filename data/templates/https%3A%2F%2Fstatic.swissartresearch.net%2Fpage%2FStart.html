[[> partial:pageHeader ]]
[[> partial:contentHeader]]

<h2>Johannes Itten Linked Archive</h2>

<semantic-table
    query='SELECT ?subject ?label (GROUP_CONCAT(DISTINCT ?type; SEPARATOR=";") as ?types) WHERE {
        ?subject a crm:E78_Curated_Holding ;
            rdfs:label ?label .
        OPTIONAL {
            ?subject crm:P2_has_type ?type .
        }
    } GROUP BY ?subject ?label
    ORDER BY ?label'
    column-configuration='[{
            "displayName": "Entity",
            "variableName": "subject"
        },
        {
            "displayName": "Types",
            "variableName": "types",
            "cellTemplate": "{{> templateTypes }}"
        },
        {
            "displayName": "Images",
            "variableName": "subject",
            "cellTemplate": "{{> templateImages }}"
        }]'
>
        <template id="templateTypes">
            {{#each (split types.value ";")}}
                <semantic-link uri="{{this}}"></semantic-link>{{#if @last}}{{else}}, {{/if}}
            {{/each}}
        </template>
        <template id="templateImages">
            <semantic-query
                query="SELECT ?image (COUNT(?imageCount) as ?count) WHERE {
                    BIND(<{{subject.value}}> as ?subject)
                    ?subject crm:P46_is_composed_of/crm:P138i_has_representation/la:digitally_shown_by/la:digitally_available_via/la:access_point ?image, ?imageCount .
                } GROUP BY ?image"
                template="{{> templateImage }}">
                <template id="templateImage">
                    {{> templateThumbnailWithViewer iri=bindings.0.image.value}}
                    {{#ifCond bindings.0.count.value ">" 1}}
                        <details>
                            <summary>more&hellip;</summary>
                            {{#each bindings}}
                                {{#if @first}}
                                {{else}}
                                    {{> templateThumbnailWithViewer iri=image.value}}
                                {{/if}}
                            {{/each}}
                        </details>
                    {{/ifCond}}
                </template>
                <template id="templateThumbnailWithViewer">
                    <mp-overlay-dialog title="Image Viewer" type="modal" bs-size="xl">
                        <mp-overlay-dialog-trigger><img src="{{iri}}/full/,100/0/default.jpg"/></mp-overlay-dialog-trigger>
                        <mp-overlay-dialog-content
                            id="image-modal">
                                <mp-page-loader 
                                    iri="[[ resolvePrefix 'page:viewImage']]"
                                    urlqueryparam-imageiri="{{iri}}"
                                    urlqueryparam-overlay="true"
                                ></mp-page-loader>
                        </mp-overlay-dialog-content>
                    </mp-overlay-dialog>
                </template>
            </semantic-query>
        </template>
</semantic-table>


[[> partial:contentFooter]]
[[> partial:pageFooter ]]